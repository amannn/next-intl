import Callout from '@/components/Callout';
import Details from '@/components/Details';

# Next.js plugin (`createNextIntlPlugin`)

When setting up `next-intl` for the [App Router](/docs/getting-started/app-router), you'll add `next-intl/plugin` to your Next.js config.

At the minimum, it will look like this:

```tsx filename="next.config.ts"
import {NextConfig} from 'next';
import createNextIntlPlugin from 'next-intl/plugin';

const nextConfig: NextConfig = {};

const withNextIntl = createNextIntlPlugin();
export default withNextIntl(nextConfig);
```

For customization, you can provide options to the plugin.

## `requestConfig` [#request-config]

By default, `next-intl` will look for a file called [`i18n/request.ts`](/docs/usage/configuration#server-client-components) which returns request-specific configuration. This file is searched for both in the `src` folder as well as in the project root with the extensions `.ts`, `.tsx`, `.js` and `.jsx`.

If you prefer to move this file somewhere else, you can provide a path to the plugin:

```tsx filename="next.config.ts"
const withNextIntl = createNextIntlPlugin(
  // Specify a custom path here
  './somewhere/else/request.ts'
);
```

Or if you're combining this with other options, you can use the `requestConfig` option:

```tsx filename="next.config.ts"
const withNextIntl = createNextIntlPlugin({
  requestConfig: './somewhere/else/request.ts'
});
```

## `experimental`

For early adopters, the Next.js plugin provides various experimental options that let you try out new features before they're released as stable.

### `createMessagesDeclaration` [#create-messages-declaration]

To enable [type-safe message arguments](/docs/workflows/typescript#messages-arguments), you can point the `createMessagesDeclaration` option to a sample messages file in order to create a strict declaration file for it.

```tsx filename="next.config.ts"
const withNextIntl = createNextIntlPlugin({
  experimental: {
    // Provide the path to the messages that you're using in `AppConfig`
    createMessagesDeclaration: './messages/en.json'
  }
  // ...
});
```

See [TypeScript augmentation](/docs/workflows/typescript) to learn more about this.

**Note:** This is not necessary when using [`useExtracted`](/docs/usage/extraction).

### `extract` [#extract]

This enables the usage of [`useExtracted`](/docs/usage/extraction) to automatically extract messages from source files.

```tsx
const withNextIntl = createNextIntlPlugin({
  experimental: {
    extract: {
      // Defines which locale to extract to
      sourceLocale: 'en'
    }
    // ...
  }
});
```

**Note:** The `extract` option should be used together with [`messages`](#messages) and [`srcPath`](#src-path).

### `messages` [#messages]

This defines where messages for locales are stored and how they're loaded.

```tsx
const withNextIntl = createNextIntlPlugin({
  experimental: {
    messages: {
      format: 'json',
      locales: 'infer',
      path: './messages',

      // Optional
      precompile: true
    }
  }
});
```

Configuring `experimental.messages` sets up a Turbo- or Webpack loader that allows messages to be imported as plain JavaScript objects (see [`format`](#format)).

#### `path`

Relative path to the directory containing messages:

```tsx
// ...
path: './messages';
```

#### `locales`

When using [`useExtracted`](/docs/usage/extraction), this defines which messages are kept in sync with [`extract.sourceLocale`](/docs/usage/plugin#extract).

You can either automatically detect all locales within `messages.path`:

```tsx
// ...
locales: 'infer';
```

… or specify them explicitly (e.g. to use a subset):

```tsx
// ...
locales: ['en', 'de', 'fr'];
```

#### `format`

Defines how your catalogs are stored (e.g. `'json'`, `'po'`, or a custom format).

##### JSON format [#formats-json]

When using this option, your messages might look like this:

```json
{
  "greeting": "Hello"
}
```

… or in case of [`useExtracted`](/docs/usage/extraction), with an auto-generated key:

```json
{
  "NhX4DJ": "Hello"
}
```

For local editing of JSON messages, you can use e.g. a [VSCode integration](/docs/workflows/vscode-integration) like i18n Ally.

Note that JSON files can only hold pairs of keys and values. To provide more context about a message like file references and descriptions, you can use [PO files](#formats-po) or create a [custom format](#formats-custom) to store additional metadata.

##### PO format [#formats-po]

When using this option, your messages will look like this:

```po
#. Advance to the next slide
#: src/components/Carousel.tsx:13
msgid "carousel.next"
msgstr "Right"
```

… or in case of [`useExtracted`](/docs/usage/extraction), with an auto-generated key:

```po
#. Advance to the next slide
#: src/components/Carousel.tsx:13
msgid "5VpL9Z"
msgstr "Right"
```

Besides the message key and the label itself, this format also supports optional descriptions and file references to all modules that consume this message.

For local editing of .po files, you can use e.g. a tool like [Poedit](https://poedit.net/).

##### Custom format [#formats-custom]

To configure a custom format, you need to specify a codec along with an extension.

The codec can be created via `defineCodec` from `next-intl/extractor`:

```tsx filename="./CustomCodec.ts"
import {defineCodec} from 'next-intl/extractor';

export default defineCodec(() => ({
  decode(content, context) {
    // ...
  },

  encode(messages, context) {
    // ...
  },

  toJSONString(content, context) {
    // ...
  }
}));
```

Then, reference it in your configuration along with an `extension`:

```tsx filename="next.config.ts"
const withNextIntl = createNextIntlPlugin({
  experimental: {
    messages: {
      format: {
        codec: './CustomCodec.ts',
        extension: '.json'
      }
      // ...
    }
  }
});
```

See also the built-in [`codecs`](https://github.com/amannn/next-intl/tree/main/packages/next-intl/src/extractor/format/codecs) for inspiration, as well as the supplied types and JSDoc reference.

<Callout>

Node.js supports native TypeScript execution like it's needed for the example above, starting with v22.18. If you're on an older version, you should define your codec as a JavaScript file.

</Callout>

#### `precompile`

When enabled, ICU messages are compiled ahead of time during the build when they are processed by the messages loader. This results in smaller bundles and faster message formatting at runtime.

See also: [Ahead-of-time compilation with `next-intl`](/blog/precompilation)

**Note:** `t.raw` is not supported with precompiled messages (see [tradeoffs](https://github.com/amannn/next-intl/blob/main/rfcs/002-icu-message-precompilation.md#tradeoffs))

<Details id="precompile-runtime-messages">
<summary>Precompile runtime-loaded messages</summary>

If you fetch messages at runtime (e.g. from a CDN), you can compile them yourself before returning them:

```tsx filename="i18n/request.ts"
import compile from 'icu-minify/compile';
import {getRequestConfig} from 'next-intl/server';

type Messages = Record<string, unknown>;

function compileMessages(messages: Messages): Messages {
  return Object.fromEntries(
    Object.entries(messages).map(([key, value]) => {
      if (typeof value === 'string') {
        return [key, compile(value)];
      }

      if (value && typeof value === 'object' && !Array.isArray(value)) {
        return [key, compileMessages(value as Messages)];
      }

      return [key, value];
    })
  );
}

export default getRequestConfig(async () => {
  // ...
  const response = await fetch('https://cdn.example.com/messages/en.json');
  const messages = (await response.json()) as Messages;

  return {
    messages: compileMessages(messages),
    // ...
  };
});
```

</Details>

### `srcPath` [#src-path]

This defines the source path where messages should be extracted from.

```tsx
const withNextIntl = createNextIntlPlugin({
  experimental: {
    srcPath: './src'
    // ...
  }
});
```

If your project is split into multiple folders, you can provide an array of paths:

```tsx
// Not using a `src` folder
srcPath: './',
```

```tsx
// Monorepo with multiple packages
srcPath: ['./src', '../ui'],
```

```tsx
// External dependency on a package
srcPath: ['./src', './node_modules/@acme/components'],
```

Note that the directories `node_modules`, `.next` and `.git` are automatically excluded from extraction, except for if they appear explicitly in the `srcPath` array.

If you want to provide messages along with your package, you can also extract them [manually](/docs/usage/extraction#manual).

**Note:** The `srcPath` option should be used together with [`extract`](#extract) and [`messages`](#messages).
